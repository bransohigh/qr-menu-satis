<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>YÃ¶netim Paneli â€” QR MenÃ¼</title>
  <style><%- include('../partials/admin-styles') %>
    .badge-durum { padding:2px 8px;border-radius:9999px;font-size:.75rem;font-weight:600; }
    .durum-paid { background:#dcfce7;color:#166534; }
    .durum-pending { background:#fef9c3;color:#854d0e; }
    .durum-failed,.durum-refunded { background:#fee2e2;color:#991b1b; }
  </style>
</head>
<body>
  <%- include('../partials/yonetim-nav', { active: 'dashboard' }) %>
  <div class="main-content" style="max-width:1200px">
    <div class="page-header">
      <h1 class="page-title">Genel BakÄ±ÅŸ</h1>
      <span style="font-size:.85rem;color:#94a3b8">SÃ¼per YÃ¶netici Paneli</span>
    </div>

    <!-- Ã–zet Kutular -->
    <div class="stats-grid" style="grid-template-columns:repeat(auto-fill,minmax(180px,1fr))">
      <div class="stat-card">
        <div class="stat-label">Toplam KullanÄ±cÄ±</div>
        <div class="stat-value" style="color:#7c3aed"><%= toplamKullanici %></div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Toplam MenÃ¼</div>
        <div class="stat-value" style="color:#0891b2"><%= toplamMenu %></div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Toplam SatÄ±n AlÄ±m</div>
        <div class="stat-value" style="color:#16a34a"><%= toplamSatinAlim %></div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Son 7 GÃ¼n</div>
        <div class="stat-value" style="color:#ea580c"><%= sonYediGunSatinAlim %></div>
      </div>
    </div>

    <!-- HÄ±zlÄ± Linkler -->
    <div class="card" style="margin-bottom:1.25rem">
      <h2 style="font-size:1rem;font-weight:700;margin-bottom:1rem">HÄ±zlÄ± EriÅŸim</h2>
      <div style="display:flex;gap:.75rem;flex-wrap:wrap;">
        <a href="/yonetim/satin-alimlar" class="btn btn-primary">ğŸ’³ SatÄ±n AlÄ±mlar</a>
        <a href="/yonetim/menuler" class="btn btn-primary">ğŸ½ MenÃ¼ler</a>
        <a href="/yonetim/kullanicilar" class="btn btn-primary">ğŸ‘¥ KullanÄ±cÄ±lar</a>
      </div>
    </div>

    <!-- Son SatÄ±n AlÄ±mlar -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
        <h2 style="font-size:1rem;font-weight:700">Son SatÄ±n AlÄ±mlar</h2>
        <a href="/yonetim/satin-alimlar" style="font-size:.85rem;color:#7c3aed">TÃ¼mÃ¼nÃ¼ GÃ¶r â†’</a>
      </div>

      <% if (sonSatinAlimlar.length === 0) { %>
        <p style="color:#94a3b8;font-size:.9rem;text-align:center;padding:2rem">HenÃ¼z satÄ±n alÄ±m yok.</p>
      <% } else { %>
        <div style="overflow-x:auto">
          <table class="table">
            <thead>
              <tr>
                <th>Tarih</th>
                <th>KullanÄ±cÄ±</th>
                <th>Ä°ÅŸletme AdÄ±</th>
                <th>Tema</th>
                <th>Tutar</th>
                <th>Durum</th>
                <th>Detay</th>
              </tr>
            </thead>
            <tbody>
              <% sonSatinAlimlar.forEach(s => { %>
                <tr>
                  <td style="white-space:nowrap;font-size:.82rem;color:#64748b">
                    <%= new Date(s.createdAt).toLocaleDateString('tr-TR', {day:'2-digit',month:'2-digit',year:'numeric'}) %>
                  </td>
                  <td style="font-size:.85rem"><%= s.user?.email || 'â€”' %></td>
                  <td style="font-size:.85rem"><%= s.menu?.businessName || 'â€”' %></td>
                  <td style="font-size:.85rem"><%= s.theme?.name || 'â€”' %></td>
                  <td style="font-size:.85rem;font-weight:600">
                    <%= Number(s.amount).toFixed(2) %> <span style="color:#94a3b8;font-weight:400"><%= s.currency %></span>
                  </td>
                  <td>
                    <span class="badge-durum durum-<%= s.status %>">
                      <%= s.status === 'paid' ? 'Ã–dendi' : s.status === 'pending' ? 'Beklemede' : s.status === 'failed' ? 'BaÅŸarÄ±sÄ±z' : 'Ä°ptal' %>
                    </span>
                  </td>
                  <td>
                    <a href="/yonetim/satin-alimlar/<%= s.id %>" class="btn btn-ghost btn-sm">Detay</a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } %>
    </div>
  </div>
</body>
</html>
