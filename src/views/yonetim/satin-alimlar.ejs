<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Satın Alımlar — Yönetim</title>
  <style><%- include('../partials/admin-styles') %>
    .badge-durum { padding:2px 8px;border-radius:9999px;font-size:.75rem;font-weight:600; }
    .durum-paid { background:#dcfce7;color:#166534; }
    .durum-pending { background:#fef9c3;color:#854d0e; }
    .durum-failed,.durum-refunded { background:#fee2e2;color:#991b1b; }
  </style>
</head>
<body>
  <%- include('../partials/yonetim-nav', { active: 'satinalimlar' }) %>
  <div class="main-content" style="max-width:1200px">
    <div class="page-header">
      <h1 class="page-title">Satın Alımlar</h1>
      <span style="font-size:.85rem;color:#94a3b8">Toplam: <%= toplamSayı %></span>
    </div>

    <div class="card">
      <% if (satinAlimlar.length === 0) { %>
        <p style="color:#94a3b8;font-size:.9rem;text-align:center;padding:2rem">Henüz satın alım yok.</p>
      <% } else { %>
        <div style="overflow-x:auto">
          <table class="table">
            <thead>
              <tr>
                <th>Tarih</th>
                <th>Kullanıcı (E-posta)</th>
                <th>İşletme Adı</th>
                <th>Tema</th>
                <th>Tutar</th>
                <th>Durum</th>
                <th style="width:80px"></th>
              </tr>
            </thead>
            <tbody>
              <% satinAlimlar.forEach(s => { %>
                <tr>
                  <td style="white-space:nowrap;font-size:.82rem;color:#64748b">
                    <%= new Date(s.createdAt).toLocaleDateString('tr-TR', {day:'2-digit',month:'2-digit',year:'numeric'}) %>
                  </td>
                  <td style="font-size:.85rem"><%= s.user?.email || '—' %></td>
                  <td style="font-size:.85rem"><%= s.menu?.businessName || '—' %></td>
                  <td style="font-size:.85rem"><%= s.theme?.name || '—' %></td>
                  <td style="font-size:.85rem;font-weight:600">
                    <%= Number(s.amount).toFixed(2) %> <span style="color:#94a3b8;font-weight:400"><%= s.currency %></span>
                  </td>
                  <td>
                    <span class="badge-durum durum-<%= s.status %>">
                      <%= s.status === 'paid' ? 'Ödendi' : s.status === 'pending' ? 'Beklemede' : s.status === 'failed' ? 'Başarısız' : 'İptal' %>
                    </span>
                  </td>
                  <td>
                    <a href="/yonetim/satin-alimlar/<%= s.id %>" class="btn btn-ghost btn-sm">Detay</a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>

        <% if (toplamSayfa > 1) { %>
          <div style="display:flex;justify-content:center;gap:.5rem;margin-top:1.25rem;flex-wrap:wrap">
            <% for (let i = 1; i <= toplamSayfa; i++) { %>
              <a href="?sayfa=<%= i %>" class="btn btn-sm <%= sayfa === i ? 'btn-primary' : 'btn-ghost' %>"><%= i %></a>
            <% } %>
          </div>
        <% } %>
      <% } %>
    </div>
  </div>
</body>
</html>
