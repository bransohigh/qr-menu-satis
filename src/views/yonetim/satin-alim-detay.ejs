<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SatÄ±n AlÄ±m DetayÄ± â€” YÃ¶netim</title>
  <style><%- include('../partials/admin-styles') %>
    .badge-durum { padding:3px 10px;border-radius:9999px;font-size:.8rem;font-weight:600; }
    .durum-paid { background:#dcfce7;color:#166534; }
    .durum-pending { background:#fef9c3;color:#854d0e; }
    .durum-failed,.durum-refunded { background:#fee2e2;color:#991b1b; }
    .bilgi-satir { display:flex;border-bottom:1px solid #f1f5f9;padding:.6rem 0; }
    .bilgi-etiket { width:160px;font-size:.83rem;font-weight:600;color:#64748b;flex-shrink:0; }
    .bilgi-deger { font-size:.88rem;color:#1e293b; }
  </style>
</head>
<body>
  <%- include('../partials/yonetim-nav', { active: 'satinalimlar' }) %>
  <div class="main-content">
    <div class="page-header">
      <div style="display:flex;align-items:center;gap:.75rem">
        <a href="/yonetim/satin-alimlar" class="btn btn-ghost btn-sm">â† Geri</a>
        <h1 class="page-title">SatÄ±n AlÄ±m DetayÄ±</h1>
      </div>
      <span class="badge-durum durum-<%= satinAlim.status %>">
        <%= satinAlim.status === 'paid' ? 'Ã–dendi' : satinAlim.status === 'pending' ? 'Beklemede' : satinAlim.status === 'failed' ? 'BaÅŸarÄ±sÄ±z' : 'Ä°ptal' %>
      </span>
    </div>

    <% if (typeof flash !== 'undefined' && flash === 'guncellendi') { %>
      <div style="background:#f0fdf4;color:#166534;border:1px solid #bbf7d0;padding:.75rem 1rem;border-radius:8px;margin-bottom:1rem;font-size:.85rem;">
        âœ… Durum baÅŸarÄ±yla gÃ¼ncellendi.
      </div>
    <% } %>

    <div class="card">
      <h2 style="font-size:1rem;font-weight:700;margin-bottom:1rem">SatÄ±n AlÄ±m Bilgileri</h2>
      <div class="bilgi-satir"><div class="bilgi-etiket">SatÄ±n AlÄ±m ID</div><div class="bilgi-deger"><code style="font-size:.8rem"><%= satinAlim.id %></code></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">Tarih</div><div class="bilgi-deger"><%= new Date(satinAlim.createdAt).toLocaleString('tr-TR') %></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">KullanÄ±cÄ±</div><div class="bilgi-deger"><a href="/yonetim/kullanicilar/<%= satinAlim.user.id %>" style="color:#7c3aed"><%= satinAlim.user.email %></a></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">Ä°ÅŸletme AdÄ±</div><div class="bilgi-deger"><%= satinAlim.menu?.businessName || 'â€”' %></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">Tema</div><div class="bilgi-deger"><%= satinAlim.theme?.name || 'â€”' %></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">Tutar</div><div class="bilgi-deger"><strong><%= Number(satinAlim.amount).toFixed(2) %> <%= satinAlim.currency %></strong></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">SaÄŸlayÄ±cÄ±</div><div class="bilgi-deger"><%= satinAlim.provider || 'â€”' %></div></div>
      <div class="bilgi-satir"><div class="bilgi-etiket">SaÄŸlayÄ±cÄ± Ref.</div><div class="bilgi-deger"><code style="font-size:.8rem"><%= satinAlim.providerRef || 'â€”' %></code></div></div>
      <% if (satinAlim.menu) { %>
        <div class="bilgi-satir">
          <div class="bilgi-etiket">MenÃ¼</div>
          <div class="bilgi-deger">
            <a href="/m/<%= satinAlim.menu.slug %>" target="_blank" style="color:#7c3aed">/m/<%= satinAlim.menu.slug %> â†—</a>
            &nbsp; <a href="/yonetim/menuler/<%= satinAlim.menu.id %>" style="color:#64748b;font-size:.83rem">MenÃ¼yÃ¼ DÃ¼zenle</a>
          </div>
        </div>
      <% } %>
    </div>

    <!-- FakePay ise durum gÃ¼ncellenebilir -->
    <% if (satinAlim.provider === 'fakepay') { %>
    <div class="card">
      <h2 style="font-size:1rem;font-weight:700;margin-bottom:1rem">ğŸ”§ Durum GÃ¼ncelle (Fake Ã–deme)</h2>
      <form action="/yonetim/satin-alimlar/<%= satinAlim.id %>/durum" method="POST" style="display:flex;gap:.75rem;align-items:center;flex-wrap:wrap">
        <select name="durum" class="form-control" style="width:auto">
          <option value="pending" <%= satinAlim.status==='pending'?'selected':'' %>>Beklemede</option>
          <option value="paid" <%= satinAlim.status==='paid'?'selected':'' %>>Ã–dendi</option>
          <option value="failed" <%= satinAlim.status==='failed'?'selected':'' %>>BaÅŸarÄ±sÄ±z</option>
          <option value="refunded" <%= satinAlim.status==='refunded'?'selected':'' %>>Ä°ptal</option>
        </select>
        <button type="submit" class="btn btn-primary">Durumu GÃ¼ncelle</button>
      </form>
    </div>
    <% } %>
  </div>
</body>
</html>
