<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Giriş Yap — QR Menü</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { fontFamily: { sans: ['Inter','system-ui','sans-serif'] }, colors: { marka: { 50:'#f5f3ff',100:'#ede9fe',600:'#7c3aed',700:'#6d28d9' } } } }
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>body{font-family:'Inter',system-ui,sans-serif;} .gecis{transition:all .2s ease;}</style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col">

  <!-- NAV -->
  <nav class="bg-white border-b border-slate-100 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 h-14 flex items-center justify-between">
      <a href="/temalar" class="text-xl font-black bg-gradient-to-r from-marka-600 to-purple-500 bg-clip-text text-transparent">QR Menü</a>
      <a href="/temalar" class="text-sm text-slate-500 hover:text-slate-800 gecis">← Temalar</a>
    </div>
  </nav>

  <div class="flex-1 flex items-center justify-center px-4 py-12">
    <div class="w-full max-w-md">
      <!-- Tabs -->
      <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
        <div class="flex border-b border-slate-100" id="tab-bar">
          <button onclick="switchTab('giris')" id="tab-giris"
            class="flex-1 py-4 text-sm font-semibold text-marka-600 border-b-2 border-marka-600 bg-marka-50 gecis">
            Giriş Yap
          </button>
          <button onclick="switchTab('kayit')" id="tab-kayit"
            class="flex-1 py-4 text-sm font-semibold text-slate-500 border-b-2 border-transparent hover:text-slate-700 gecis">
            Kayıt Ol
          </button>
        </div>

        <!-- Giriş Formu -->
        <div id="form-giris" class="p-6">
          <div id="giris-hata" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-600"></div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-slate-700 mb-1.5">E-posta</label>
            <input id="giris-email" type="email" autocomplete="email" placeholder="ornek@eposta.com"
              class="w-full px-3 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-marka-600 gecis" />
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium text-slate-700 mb-1.5">Şifre</label>
            <input id="giris-sifre" type="password" autocomplete="current-password" placeholder="••••••••"
              class="w-full px-3 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-marka-600 gecis" />
          </div>
          <button onclick="girisYap()"
            class="w-full bg-marka-600 hover:bg-marka-700 text-white font-semibold py-2.5 px-4 rounded-xl gecis text-sm">
            Giriş Yap
          </button>
        </div>

        <!-- Kayıt Formu -->
        <div id="form-kayit" class="p-6 hidden">
          <div id="kayit-hata" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-600"></div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-slate-700 mb-1.5">E-posta</label>
            <input id="kayit-email" type="email" autocomplete="email" placeholder="ornek@eposta.com"
              class="w-full px-3 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-marka-600 gecis" />
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-slate-700 mb-1.5">Şifre</label>
            <input id="kayit-sifre" type="password" autocomplete="new-password" placeholder="En az 8 karakter"
              class="w-full px-3 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-marka-600 gecis" />
          </div>
          <div class="mb-6">
            <label class="block text-sm font-medium text-slate-700 mb-1.5">Şifre Tekrar</label>
            <input id="kayit-sifre2" type="password" autocomplete="new-password" placeholder="••••••••"
              class="w-full px-3 py-2.5 border border-slate-200 rounded-xl text-sm focus:outline-none focus:border-marka-600 gecis" />
          </div>
          <button onclick="kayitOl()"
            class="w-full bg-marka-600 hover:bg-marka-700 text-white font-semibold py-2.5 px-4 rounded-xl gecis text-sm">
            Hesap Oluştur
          </button>
        </div>
      </div>

      <p class="text-center text-xs text-slate-400 mt-4">
        Kayıt olarak <a href="#" class="underline">Kullanım Koşulları</a>'nı kabul etmiş olursunuz.
      </p>
    </div>
  </div>

  <script>
    const sonra = '<%= sonra %>';

    function switchTab(tab) {
      const giris = document.getElementById('form-giris');
      const kayit = document.getElementById('form-kayit');
      const tGiris = document.getElementById('tab-giris');
      const tKayit = document.getElementById('tab-kayit');
      if (tab === 'giris') {
        giris.classList.remove('hidden'); kayit.classList.add('hidden');
        tGiris.className = 'flex-1 py-4 text-sm font-semibold text-marka-600 border-b-2 border-marka-600 bg-marka-50 gecis';
        tKayit.className = 'flex-1 py-4 text-sm font-semibold text-slate-500 border-b-2 border-transparent hover:text-slate-700 gecis';
      } else {
        kayit.classList.remove('hidden'); giris.classList.add('hidden');
        tKayit.className = 'flex-1 py-4 text-sm font-semibold text-marka-600 border-b-2 border-marka-600 bg-marka-50 gecis';
        tGiris.className = 'flex-1 py-4 text-sm font-semibold text-slate-500 border-b-2 border-transparent hover:text-slate-700 gecis';
      }
    }

    function gosterHata(el, msg) {
      el.textContent = msg;
      el.classList.remove('hidden');
      setTimeout(() => el.classList.add('hidden'), 6000);
    }

    async function girisYap() {
      const hataEl = document.getElementById('giris-hata');
      const email = document.getElementById('giris-email').value.trim();
      const sifre = document.getElementById('giris-sifre').value;
      if (!email || !sifre) { gosterHata(hataEl, 'E-posta ve şifre zorunludur.'); return; }
      try {
        const r = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password: sifre }),
        });
        const d = await r.json();
        if (!r.ok) { gosterHata(hataEl, d?.error?.message || 'Giriş başarısız.'); return; }
        const rol = d?.user?.role;
        if (sonra && sonra !== '/giris') { window.location.href = sonra; return; }
        if (rol === 'ADMIN') { window.location.href = '/yonetim'; }
        else { window.location.href = '/panel'; }
      } catch { gosterHata(hataEl, 'Bir hata oluştu. Lütfen tekrar deneyin.'); }
    }

    async function kayitOl() {
      const hataEl = document.getElementById('kayit-hata');
      const email = document.getElementById('kayit-email').value.trim();
      const sifre = document.getElementById('kayit-sifre').value;
      const sifre2 = document.getElementById('kayit-sifre2').value;
      if (!email || !sifre) { gosterHata(hataEl, 'E-posta ve şifre zorunludur.'); return; }
      if (sifre !== sifre2) { gosterHata(hataEl, 'Şifreler eşleşmiyor.'); return; }
      if (sifre.length < 8) { gosterHata(hataEl, 'Şifre en az 8 karakter olmalıdır.'); return; }
      try {
        const r = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password: sifre }),
        });
        const d = await r.json();
        if (!r.ok) { gosterHata(hataEl, d?.error?.message || 'Kayıt başarısız.'); return; }
        window.location.href = '/temalar';
      } catch { gosterHata(hataEl, 'Bir hata oluştu. Lütfen tekrar deneyin.'); }
    }

    // Enter tuşu desteği
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        if (!document.getElementById('form-giris').classList.contains('hidden')) girisYap();
        else kayitOl();
      }
    });
  </script>
</body>
</html>
